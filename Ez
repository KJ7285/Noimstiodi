local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local kijb = {}

function kijb:CreateLibrary(title)
    local ScreenGui = Instance.new("ScreenGui")
    local MainFrame = Instance.new("Frame")
    local TitleLabel = Instance.new("TextLabel")
    local ToggleButton = Instance.new("TextButton")
    local TabsHolder = Instance.new("Frame")
    local TabsList = Instance.new("UIListLayout")

    ScreenGui.Parent = game.CoreGui
    ScreenGui.ResetOnSpawn = false

    -- Main UI Frame
    MainFrame.Parent = ScreenGui
    MainFrame.Size = UDim2.new(0, 420, 0, 380)
    MainFrame.Position = UDim2.new(0.5, -210, 0.5, -190)
    MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
    MainFrame.BorderSizePixel = 0
    MainFrame.ClipsDescendants = true
    MainFrame.Active = true

    -- Add corner radius
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 10)
    UICorner.Parent = MainFrame

    -- Title Label
    TitleLabel.Parent = MainFrame
    TitleLabel.Size = UDim2.new(1, 0, 0, 40)
    TitleLabel.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
    TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    TitleLabel.Text = title
    TitleLabel.Font = Enum.Font.GothamBold
    TitleLabel.TextSize = 18

    -- Toggle Button
    ToggleButton.Parent = MainFrame
    ToggleButton.Size = UDim2.new(0, 100, 0, 30)
    ToggleButton.Position = UDim2.new(1, -110, 0, 5)
    ToggleButton.BackgroundColor3 = Color3.fromRGB(70, 70, 80)
    ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    ToggleButton.Text = "Close"
    ToggleButton.Font = Enum.Font.GothamBold
    ToggleButton.TextSize = 14

    -- Tabs Holder
    TabsHolder.Parent = MainFrame
    TabsHolder.Size = UDim2.new(1, 0, 0, 50)
    TabsHolder.Position = UDim2.new(0, 0, 0, 45)
    TabsHolder.BackgroundColor3 = Color3.fromRGB(30, 30, 35)

    TabsList.Parent = TabsHolder
    TabsList.FillDirection = Enum.FillDirection.Horizontal
    TabsList.Padding = UDim.new(0, 5)

    local Library = {}
    Library.Tabs = {}

    function Library:CreateTab(tabName)
        local TabButton = Instance.new("TextButton")
        TabButton.Parent = TabsHolder
        TabButton.Size = UDim2.new(0, 120, 1, 0)
        TabButton.BackgroundColor3 = Color3.fromRGB(55, 55, 65)
        TabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        TabButton.Text = tabName
        TabButton.Font = Enum.Font.GothamBold
        TabButton.TextSize = 14

        local TabFrame = Instance.new("ScrollingFrame")
        TabFrame.Parent = MainFrame
        TabFrame.Size = UDim2.new(1, 0, 1, -100)
        TabFrame.Position = UDim2.new(0, 0, 0, 100)
        TabFrame.BackgroundTransparency = 1
        TabFrame.Visible = false
        TabFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
        TabFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
        TabFrame.ScrollBarThickness = 5

        local TabList = Instance.new("UIListLayout")
        TabList.Parent = TabFrame
        TabList.Padding = UDim.new(0, 5)

        Library.Tabs[tabName] = TabFrame

        TabButton.MouseButton1Click:Connect(function()
            for _, tab in pairs(Library.Tabs) do
                tab.Visible = false
            end
            TabFrame.Visible = true
        end)

        local Tab = {}
        Tab.Frame = TabFrame

        function Tab:AddButton(text, callback)
            local Button = Instance.new("TextButton")
            Button.Parent = TabFrame
            Button.Size = UDim2.new(1, -20, 0, 40)
            Button.BackgroundColor3 = Color3.fromRGB(50, 150, 255)
            Button.TextColor3 = Color3.fromRGB(255, 255, 255)
            Button.Text = text
            Button.Font = Enum.Font.GothamBold
            Button.TextSize = 16

            Button.MouseButton1Click:Connect(function()
                callback()
            end)
        end

        function Tab:AddToggle(text, callback)
            local Toggle = Instance.new("TextButton")
            Toggle.Parent = TabFrame
            Toggle.Size = UDim2.new(1, -20, 0, 40)
            Toggle.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
            Toggle.TextColor3 = Color3.fromRGB(255, 255, 255)
            Toggle.Text = text .. " [OFF]"
            Toggle.Font = Enum.Font.GothamBold
            Toggle.TextSize = 16

            local toggled = false
            Toggle.MouseButton1Click:Connect(function()
                toggled = not toggled
                Toggle.BackgroundColor3 = toggled and Color3.fromRGB(100, 255, 100) or Color3.fromRGB(255, 100, 100)
                Toggle.Text = text .. (toggled and " [ON]" or " [OFF]")
                callback(toggled)
            end)
        end

        return Tab
    end

    -- Toggle UI Visibility
    ToggleButton.MouseButton1Click:Connect(function()
        local targetSize = MainFrame.Size == UDim2.new(0, 420, 0, 380) and UDim2.new(0, 420, 0, 0) or UDim2.new(0, 420, 0, 380)
        TweenService:Create(MainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Size = targetSize}):Play()
    end)

    return Library
end

return kijb
